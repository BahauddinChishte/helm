---
import SEO from '../components/SEO.astro';
import GTM from '../components/GTM.astro';
import GTMBody from '../components/GTMBody.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import QuoteModal from '../components/QuoteModal.jsx';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  image?: string;
  type?: 'website' | 'article';
  canonical?: string;
  noindex?: boolean;
}

const { title, description, image, type, canonical, noindex } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <SEO
      title={title}
      description={description}
      image={image}
      type={type}
      canonical={canonical}
      noindex={noindex}
    />
    <GTM />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  </head>
  <body class="font-sans antialiased bg-white text-brand-navy">
    <GTMBody />
    <Header />
    <main>
      <slot />
    </main>
    <Footer />
    <QuoteModal client:load />
    <script>
      window.dataLayer = window.dataLayer || [];

      function trackEvent(eventName: string, eventData: any = {}) {
        window.dataLayer.push({
          event: eventName,
          ...eventData
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        // Quote modal trigger setup
        const quoteButtons = document.querySelectorAll('[data-open-quote-modal]');
        quoteButtons.forEach(button => {
          button.addEventListener('click', (e) => {
            e.preventDefault();
            const trigger = document.querySelector('[data-quote-modal-trigger]') as HTMLButtonElement;
            trigger?.click();
          });
        });

        document.querySelectorAll('a[data-track]').forEach(link => {
          link.addEventListener('click', (e) => {
            const element = e.currentTarget as HTMLElement;
            trackEvent('cta_click', {
              cta_text: element.textContent?.trim(),
              cta_location: element.dataset.track,
              cta_url: (element as HTMLAnchorElement).href
            });
          });
        });

        document.querySelectorAll('form').forEach(form => {
          form.addEventListener('submit', (e) => {
            const formElement = e.currentTarget as HTMLFormElement;
            trackEvent('form_submission', {
              form_id: formElement.id || 'unknown',
              form_location: window.location.pathname
            });
          });
        });

        document.querySelectorAll('video, [data-video]').forEach(video => {
          video.addEventListener('play', (e) => {
            const videoElement = e.currentTarget as HTMLElement;
            trackEvent('video_play', {
              video_title: videoElement.dataset.title || 'unknown',
              video_location: window.location.pathname
            });
          });
        });
      });
    </script>
  </body>
</html>

<style is:global>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    overflow-x: hidden;
    font-family: 'Montserrat', sans-serif;
  }

  img {
    max-width: 100%;
    height: auto;
    display: block;
  }

  h1 {
    font-family: 'Montserrat', sans-serif;
    font-size: 3.5rem;
    line-height: 1.2;
    font-weight: 600;
    color: rgb(52, 58, 90);
  }

  h2 {
    font-family: 'Montserrat', sans-serif;
    font-size: 2.5rem;
    line-height: 1.2;
    font-weight: 600;
    color: rgb(40, 40, 40);
  }

  h3 {
    font-family: 'Montserrat', sans-serif;
    font-size: 2rem;
    line-height: 1.2;
    font-weight: 600;
    color: rgb(40, 40, 40);
  }

  h4 {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.5rem;
    line-height: 1.3;
    font-weight: 600;
    color: rgb(40, 40, 40);
  }

  h5 {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.25rem;
    line-height: 1.4;
    font-weight: 600;
    color: rgb(40, 40, 40);
  }

  h6 {
    font-family: 'Montserrat', sans-serif;
    font-size: 1rem;
    line-height: 1.4;
    font-weight: 600;
    color: rgb(40, 40, 40);
  }

  p {
    font-family: 'Montserrat', sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    font-weight: 400;
  }

  @media (max-width: 768px) {
    h1 {
      font-size: 2.5rem;
    }

    h2 {
      font-size: 2rem;
    }

    h3 {
      font-size: 1.5rem;
    }

    h4 {
      font-size: 1.25rem;
    }
  }

  .grid-background {
    background-image:
      linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
      linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
    background-size: 50px 50px;
    mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1) 0%, rgba(0, 0, 0, 0.4) 40%, rgba(0, 0, 0, 0) 70%);
    -webkit-mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1) 0%, rgba(0, 0, 0, 0.4) 40%, rgba(0, 0, 0, 0) 70%);
  }
</style>
